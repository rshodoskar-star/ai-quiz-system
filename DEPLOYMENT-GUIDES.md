# دليل النشر الكامل – نظام الاختبارات الذكي

هذا الدليل يجمع كل المعلومات الخاصة بنشر **نظام الاختبارات الذكي** في مكان واحد، بدلاً من تشتيتها في عدة ملفات. إذا كنت ترغب في نشر النظام محلياً، أو على خدمة استضافة سحابية مثل *Railway*، أو على نطاق خاص، فستجد هنا كل الخطوات اللازمة، بالإضافة إلى ملاحظات الإصدار الثامن وقائمة التحقق.

> **ملاحظة:** هذا الملف يحل محل الوثائق التالية: `DEPLOYMENT.md`, `DEPLOYMENT-CHECKLIST.md`, `DEPLOY-ALDOSARI-NET.md`, `RAILWAY-DEPLOYMENT-GUIDE.md` و `V8.0-DEPLOYMENT-GUIDE.md`، حيث يجمع محتواها مع تبسيط وترتيب المعلومات لتسهيل عملية النشر.

## 1. نظرة عامة على عملية النشر

تقوم عملية النشر على خطوتين رئيسيتين:

- **إنشاء الخدمة وتشغيلها**: إعداد بيئة تشغيل (محلية أو سحابية)، إعداد متطلبات النظام (Node.js وPython ومكتبات OCR)، ثم تشغيل الخوادم اللازمة.
- **ربط الخدمة بالمجال وتفعيل الميزات**: اختيار خطة الاستضافة، إضافة متغيرات البيئة (مثل مفاتيح API)، وربط المجال (domain) بالخدمة.

## 2. النشر المحلي (Local)

يمكن تشغيل النظام محلياً على جهازك باستخدام Docker أو بدون Docker:

1. **استنساخ المستودع:**
   ```bash
   git clone https://github.com/rshodoskar-star/ai-quiz-system.git
   cd ai-quiz-system
   ```
2. **تثبيت المتطلبات:**
   - **Node.js**: تأكد من وجود Node.js بإصدار ≥ 18.
   - **Python**: تأكد من وجود Python 3.10.
   - **PyMuPDF وOCR**: إذا أردت تشغيل استخراج النص محلياً، ثبت المكتبات: `pip install PyMuPDF==1.23.8 paddlepaddle paddleocr opencv-python-headless ftfy`.
3. **تشغيل الخدمة:**
   - لتشغيل الخادم Node.js: `npm install && node server-v8-FIXED.js`.
   - لتشغيل خدمة استخراج الـPDF (إن وجدت): `python extract_pdf-v8.py` (يمكن دمجها في Docker).
4. **التجربة محلياً:** افتح المتصفح على `http://localhost:8000` وتأكد من إمكانية رفع ملف PDF وتوليد الاختبار.

## 3. النشر على Railway

هذا القسم يدمج ما كان موجوداً في دليل Railway السابق مع قائمة التحقق:

1. **إنشاء حساب Railway**: قم بالتسجيل في [railway.app](https://railway.app/). اختر الخطة المناسبة (يفضل خطة تتضمن خدمة Docker إن كنت بحاجة لـOCR).
2. **تثبيت Railway CLI (اختياري):**
   ```bash
   npm install -g @railway/cli
   railway login
   ```
3. **إعداد المشروع:**
   - اربط المستودع بـ Railway عبر لوحة التحكم أو باستخدام الأمر: `railway init`.
   - تأكد من وجود ملف `Dockerfile` يحتوي على جميع الاعتمادات اللازمة (انظر دليل الإصدار الثامن أدناه). 
   - أضف متغيرات البيئة التالية من لوحة التحكم:
     - `OPENAI_API_KEY`
     - `GPT_MODEL` (مثلاً `gpt-4o`)
     - متغيرات أخرى مطلوبة (مثل مجال الموقع أو إعدادات البريد).
4. **التشغيل والنشر:**
   - اضغط على زر **Deploy** في لوحة Railway وسيبدأ بناء صورة Docker وتشغيل الخدمة.
   - انتظر حتى تظهر الحالة *Deployed successfully*، ثم انسخ رابط الخدمة لربطه بالمجال.
5. **ربط المجال (اختياري):**
   - إذا كان لديك مجال (مثل `aldosari.net`)، يمكنك إضافته في قسم Domains في Railway وتوجيه DNS إلى العنوان المقدم.
6. **قائمة التحقق:**
   - ✔ تأكد من إضافة مفاتيح API وملفات البيئة.
   - ✔ تأكد من اختيار الخطة الصحيحة (Starter أو Hobby).
   - ✔ تأكد من أن الـDockerfile يستخدم صورة `python:3.10-slim` ويثبت مكتبات OCR.
   - ✔ اختبر الخدمة بعد النشر عبر رفع ملف PDF ومراجعة الأسئلة.

## 4. النشر على نطاق aldosari.net

إذا أردت تشغيل النظام على مجالك الخاص (`aldosari.net` مثلاً)، يمكنك اتباع الخطوات التالية (مستخلصة من `DEPLOY-ALDOSARI-NET.md`):

1. **إعداد الـDNS:** سجّل الدخول إلى مدير النطاق وأضف سجلات A أو CNAME لتوجيه المجال إلى العنوان الذي توفره خدمة الاستضافة (Railway أو غيرها).
2. **إعداد SSL:** Railway تدعم شهادات HTTPS تلقائياً عند ربط المجال. تأكد من تفعيل خيار HTTPS في لوحة التحكم.
3. **اختبار المجال:** بعد تحديث سجلات DNS، انتظر انتشارها (قد يستغرق 15 دقيقة). ثم افتح `https://www.aldosari.net` للتحقق من تشغيل النظام.

## 5. دليل إصدار 8.0 والميزات الجديدة

يحتوي الإصدار الثامن على تحسينات جوهرية في عملية استخراج النص والأسئلة، أهمها:

- **استخدام `page.get_text("dict")`:** لقراءة النص مع الإحداثيات بدلاً من الوضع المبسط، مما يسمح بترتيب الفقرات والأعمدة الصحيحة【112003352826674†screenshot】.
- **دعم RTL (من اليمين لليسار):** فرز البلوكات والمحتويات بحسب ترتيب `y` ثم `x` بالعكس لضمان قراءة النص العربي بشكل صحيح【112003352826674†screenshot】.
- **دعم OCR بالاعتماد على PaddleOCR:** إذا كانت الصفحة صورة، يستخدم البرنامج التعرف البصري للحروف لاستخراج النص.
- **تطبيع النص:** إزالة التشكيل، إصلاح ترميز UTF-8، توحيد شكل الحروف، وتنظيف المسافات.
- **تحسين `Dockerfile`:** استخدام صورة `python:3.10-slim` وتثبيت مكتبات النظام اللازمة (libgl1، libxi، libjpeg وغيرها) لضمان تشغيل PaddleOCR وOpenCV دون أخطاء.

لإتمام عملية النشر لهذا الإصدار، تأكد من استخدام ملفات `server-v8-FIXED.js`, `extract_pdf-v8.py`, و`Dockerfile-v8-FINAL` المرفقة في المستودع.

## 6. قائمة التحقق عند النشر (Checklist)

استخدم هذه القائمة السريعة قبل كل نشر للتأكد من أن كل شيء جاهز:

| العنصر | تحقق |
| --- | --- |
| تم تحديث المتطلبات (`package.json`, `requirements.txt`) | ✔ |
| تم تحديث `Dockerfile` وتثبيت مكتبات OCR | ✔ |
| تمت إضافة مفاتيح API في إعدادات البيئة | ✔ |
| تم اختبار استخراج النص والـOCR محلياً | ✔ |
| تم اختيار خطة الاستضافة المناسبة | ✔ |
| تم ربط المجال وإعداد HTTPS (إذا لزم) | ✔ |

## 7. الخلاصة

بتجميع أدلة النشر في ملف واحد، أصبح من السهل عليك إيجاد المعلومات اللازمة لتشغيل النظام سواءً محلياً أو على خدمات الاستضافة المختلفة. يمكنك الرجوع إلى الأقسام أعلاه حسب حاجتك، كما يُنصح بمتابعة تحديثات المستودع لضمان الحصول على آخر الإصلاحات والميزات.
