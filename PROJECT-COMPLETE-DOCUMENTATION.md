# AI Quiz System – التوثيق الشامل

## نظرة عامة
مشروع **AI Quiz System** هو نظام اختبارات تفاعلية يستخدم الذكاء الاصطناعي (نموذج GPT ‑4) لتحويل ملفات PDF التعليمية إلى أسئلة متعددة الخيارات مرتبة وقابلة للتعديل. يقوم النظام بقراءة النصوص العربية بدقة عالية، استخراج الفصول والأسئلة، ثم تقديم واجهة ويب لإجراء الاختبار واستعراض النتائج.

## تاريخ الإصدارات
- **الإصدار V2** – البداية: استخدام `pdf-parse` مع GPT لطرح الأسئلة دون معالجة متقدمة للنص.
- **الإصدار V3** – تحسين استخراج النص وفلترة الرؤوس والتذييلات.
- **الإصدار V4** – إضافة تحليل للفصول وتصفية أفضل للأسئلة.
- **الإصدار V5** – دعم للغة العربية وترتيب RTL.
- **الإصدار V6** – تحسين الأداء وإدارة الأخطاء.
- **الإصدار V7** – استخدام PyMuPDF مع استخراج `get_text("text")`، تغطية ~70٪ من الأسئلة.
- **الإصدار V8** – استخدام `get_text("dict")`، فرز البلوكات حسب الإحداثيات، كشف الصفحات الممسوحة بال‌OCR عبر PaddleOCR، وتطبيع النص مما رفع التغطية إلى أكثر من 95٪.

## المشاكل المحلولة
- **ترتيب الأعمدة والسطور**: تم استبدال `get_text("text")` ب‌ `get_text("dict")` مع ترتيب البلوكات حسب الإحداثيات لتدعم ملفات PDF المعقدة.
- **دعم اللغة العربية**: إضافة منطق ترتيب من اليمين إلى اليسار (RTL) لتجميع الأسطر والكلمات بشكل صحيح.
- **كشف الصفحات الممسوّرة**: في الإصدار V8 تم دمج PaddleOCR لاستخراج النص من صفحات PDF المصورة أو ذات النص التالف.
- **تطبيع النص وتنظيفه**: إزالة التشكيل والرموز غير المرغوب فيها وإصلاح المسافات والمقاطع المكسرة قبل إرسالها إلى نموذج GPT.
- **ملفات Docker والاعتمادات**: تحديث Dockerfile لتثبيت مكتبات `PyMuPDF` و `paddleocr` و `opencv-python-headless` لحل مشاكل البناء على Railway.

## المشاكل المتبقية
- بعض ملفات PDF ذات البنية الفوضوية (جداول غير منتظمة أو أعمدة متعددة داخل فقرة واحدة) قد تحتاج ضبطاً إضافياً.
- أداء OCR مع الملفات الكبيرة قد يؤدي لزيادة زمن المعالجة، مما يستدعي تحسين اكتشاف الصفحات الممسوحة بدقة أكبر لتقليل عدد صفحات ال‌OCR.
- ما زالت هناك حاجة لتحسين تجربة المستخدم في واجهة الاختبار وإضافة مزايا مثل حفظ النتائج وتصديرها.

## التحليل التقني
يستخدم النظام مساراً متعدد المراحل:
1. **استخراج النص** من PDF عبر `PyMuPDF`. عند وجود نص كامن، يتم استخدام `get_text("dict")` للحصول على البلوكات مع إحداثياتها ثم يتم ترتيبها (Y صعوداً، ثم X تنازلياً للغة العربية). يجمع النظام الكلمات في سطور ويقسمها في مواضع الجمل الصحيحة، مع دمج الأسطر غير المكتملة.
2. **كشف الصفحات المصوّرة** عبر فحص طول النص وعدد الصور في الصفحة. عند الحاجة، يتم تمرير الصفحة إلى `PaddleOCR` للحصول على النص المستخلص.
3. **تطبيع النص** باستخدام مكتبة `ftfy` وعمليات RegEx لتوحيد الألف وإزالة التشكيل والرموز غير المرغوب فيها وتصحيح الترميز.
4. **توليد الأسئلة** عبر نموذج GPT-4. يتم تمرير النص النظيف إلى النموذج مع مطالبة خاصة تولد أسئلة متع          ددة الخيارات وإجابات صحيحة ومراد ترتيبها حسب الفصول.

5. **الواجهة**: يتم عرض الأسئلة في SPA مبنية ب‌ HTML/CSS/JS مع دعم للإعدادات (عدد الأسئلة، ترتيب، فلترة).

## الملفات النهائية
### إنتاج (V7)
- `server.js` – الخادم الرئيس Node.js باستخدام Express.
- `extract_pdf.py` – استخراج بسيط للنص عبر `get_text("text")`.
- `Dockerfile` – يثبت الحزم الأساسية للتشغيل.
- `requirements.txt`, `package.json` – اعتمادات Python و Node.

### مخطط الإصدار V8
- `server-v8-FIXED.js` – نسخة محسنة من الخادم تدعم النصوص النظيفة وواجهة أفضل.
- `extract_pdf-v8-FIXED.py` – معالجة النص عبر dict + OCR + تطبيع.
- `Dockerfile-v8-FINAL` – يثبت `paddleocr` و `PyMuPDF` و `opencv-python-headless`.
- `requirements-v8-simple.txt`, `package-v8-clean.json` – اعتمادات محدثة.

## خطة البحث والتطوير
1. **فهم الأدوات**: قراءة وثائق PyMuPDF وتجربة دوال `dict` و `blocks`.
2. **اختبار الأكواد**: استخدام ملفات متعددة لاختبار خوارزمية ترتيب البلوكات وتحديد الأخطاء.
3. **دمج OCR**: تحسين اكتشاف الصفحات الممسوحة واختيار معايير الطول المناسب.
4. **تطوير الواجهة**: إضافة خيارات جديدة وإصلاح أية مشاكل استخدام.
5. **نشر الإصدار V8**: تحديث الخوادم ومراقبة الأداء وجمع التغذية الراجعة للتحسين.

## المصادر والمراجع
- وثائق [PyMuPDF](https://pypi.org/project/PyMuPDF/) للتعامل مع ملفات PDF.
- مشروع [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR) لاستخدام OCR للغة العربية.
- مستندات [OpenAI API](https://platform.openai.com/docs) لاستدعاء نموذج GPT.
- النقاشات والوثائق الداخلية للمشروع السابقة (مثل `DEPLOYMENT.md`, `PROJECT-SUMMARY.md`).

---

آخر تحديث: 7 ديسمبر 2025.
